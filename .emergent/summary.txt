<analysis>
The AI engineer's trajectory commenced with summarizing the UnityOps SaaS platform, highlighting its MVP to 1.x evolution, existing features like auth, multi-tenancy, mock Xero, and CSV ingest, alongside persistent 502 errors and frontend issues. The initial focus involved implementing a 30-Day Action Plan, UnityIQ Job Monitor, and Orgless Onboarding, while addressing Xero connection entitlement gating. The trajectory details the implementation of a Start Lite Trial feature, initially as a direct upgrade, then polished per user feedback. Subsequent efforts included correcting routing for a Dashboard button and enhancing the Finance Dashboard with additional KPIs and summary sections. The most recent work concentrated on resolving Xero mock OAuth flow issues (incorrect authentication requirement, form data parsing) and a critical 502 error caused by a missing  import in FastAPI. The work paused after fixing the 502, awaiting user verification.
</analysis>

<product_requirements>
UnityOps is a portfolio-ops application for solopreneurs, unifying finance, CRM deduplication/cross-sell, and vendor savings into a 3-Day Synergy Snapshot PDF with a 30-day action plan. It targets multi-entity visibility, immediate savings/revenue, and quick board-ready snapshots.
The product's v1.0â€“v1.2 scope includes: Auth, multi-tenancy, RBAC, audit logs, org preferences/flags/banners, Stripe Lite billing (gating preserved), finance ingest (CSV & Xero live-ready), trends, CRM ingest (mock HubSpot/CSV), vendor ingest (CSV), Snapshot PDF generation, Settings, Connections, Data Health, and basic Alerts.

Current implementation covers Day 0-3 core features (auth, multi-tenancy, mock Xero, CSV ingest, Finance Dashboard with trends, Customer Lens, Vendor Optimizer) and Stripe Lite billing. The recent trajectory detailed explicit feature additions and enhancements:
1.  **30-Day Action Plan in Snapshot PDF**: Extend  to include top 10 open checklist items, sorted, grouped by owner, with specific PDF layout and empty states.
2.  **UnityIQ Job Monitor & Run now**: Implement  collection and backend APIs (, , ) and a frontend  component for on-demand data refresh with progress, ETA, and error display, ensuring idempotency and RBAC.
3.  **Orgless Onboarding Bulletproof**: Create a seamless onboarding experience for new verified users without an organization, ensuring clear CTAs, correct  handling, conditional  header logic, precise  behavior, and dedicated empty-state UI cards.
4.  **Xero Connection Entitlement Gating**: Implement a proactive check for Xero connector limits based on billing entitlements, providing clear messages and redirecting users to  if limits are exceeded.
</product_requirements>

<key_technical_concepts>
-   **Full-stack**: React (frontend), FastAPI (backend), MongoDB (database).
-   **Authentication**: JWT, bcrypt, email verification, OAuth 2.0 (Xero).
-   **Multi-tenancy/RBAC**:  context, roles, .
-   **Integrations**: Stripe Billing, Xero (mock & live).
-   **PDF Generation**: ReportLab.
-   **Asynchronous Processing**: Backend job workers.
</key_technical_concepts>

<code_architecture>


-   : Main FastAPI application.
    -   **Importance**: Handles core API endpoints, MongoDB integration, authentication, RBAC.
    -   **Changes**: Initially included 30-Day Action Plan and UnityIQ Job Monitor endpoints. Modified to add  and  endpoints for direct plan upgrades/reverts. Fixed Xero mock consent endpoint by removing . Modified  to accept  data instead of JSON. Crucially, fixed a 502 error by explicitly importing  from To use the fastapi command, please install "fastapi[standard]":

	pip install "fastapi[standard]".
-   : Axios client.
    -   **Importance**: Centralizes API calls and token management.
    -   **Changes**: Conditionally sets  header.
-   : Main React router.
    -   **Importance**: Defines application-wide routes and their guards.
    -   **Changes**:  usage updated. Modified to include  route mapping directly to  instead of the generic  component, to align with user expectations.
-   : Navigation bar.
    -   **Importance**: Provides top-level navigation, user info, and org switcher.
    -   **Changes**: Added proactive Xero connector entitlement checks. Modified to include a Dashboard navigation button.
-   : Authentication/authorization guard.
    -   **Importance**: Controls access to routes.
    -   **Changes**: Added  prop.
-   : Organization context.
    -   **Importance**: Manages the currently selected organization and user's memberships.
    -   **Changes**: Hardened to properly handle  as  for orgless users, persisting it via .
-   : Connections page.
    -   **Importance**: Manages external integrations (e.g., Xero).
    -   **Changes**: Modified to fetch entitlements, show Start Lite Trial button (for eligible users on FREE plan), and display plan information. Rewritten to integrate  and debug info banners, incorporating polish requirements like skeleton loaders and polling.
-   : Finance dashboard.
    -   **Importance**: Primary dashboard for financial insights.
    -   **Changes**: Initially integrated  and , displaying an orgless empty-state card. Enhanced to display GM%, Opex KPI cards, a Synergy Score block, Customer Lens summary, Vendor Lens summary, and the  CTA.
-   : Provides real-time status updates for data synchronization jobs.
    -   **Changes**: Created component.
-   : **NEW** component.
    -   **Importance**: Displays a prominent call-to-action for upgrading to the Lite plan.
    -   **Changes**: Created to encapsulate the UI and logic for the Lite Trial upgrade card on the  page.
-   : **NEW** component.
    -   **Importance**: Provides a loading placeholder for the Lite Trial card.
    -   **Changes**: Created to improve UX during entitlement fetching.
-   : **NEW** component.
    -   **Importance**: Offers a compact Start Lite Trial CTA within the Finance Dashboard.
    -   **Changes**: Created to provide an alternative upgrade path directly on the dashboard.
</code_architecture>

<pending_tasks>
-   **Stripe Full End-to-End Testing**: Awaiting , , , .
-   **Kubernetes Readiness Probe Fix**: Requires Ops/Support to set  on port 8001.
-   **Scheduled Refresh (Foundational)**: Implement nightly finance refresh in Org Settings.
-   **CRM Bulk Review (v1.1)**: Implement bulk merge/split with undo and learned aliases.
-   **Alerts (Basic Live)**: Implement basic email/Slack alerts.
-   **Job Engine Error Cap**: Add a limit to the  array for .
-   **Job Polling Visibility**: Implement pausing polling when the browser tab is hidden.
-   **JobBar Last Sync**: Wire the Last sync placeholder to actual .
-   **Finance Dashboard Sparklines**: Implement sparklines on KPI cards.
-   **Finance Dashboard Banners**: Implement Snapshot/Demo banners.
-   **Finance Dashboard Tooltips**: Add tooltips on gated actions.
</pending_tasks>

<current_work>
Immediately prior to this summary, the AI engineer was addressing critical issues preventing users from logging in and connecting to Xero.
The user reported a 502 (Bad Gateway) error when attempting to log in, which the AI engineer quickly diagnosed by checking backend logs. The root cause was a  in , indicating a missing import for the  dependency in FastAPI. This was fixed by adding  to the  statement.

Preceding this, the AI engineer fixed issues related to the Xero mock OAuth flow:
1.  The  endpoint mistakenly required authentication (), preventing the flow from starting. This was corrected by removing the dependency.
2.  The  endpoint failed because the HTML form submitted data as , but the FastAPI endpoint expected JSON. This was resolved by changing the callback function signature to accept  and  as  parameters.

All these fixes required restarting the backend service. The current state is that the backend has successfully started after the  import fix, and the AI is awaiting user verification of the login functionality and the Xero connection flow.
</current_work>

<optional_next_step>
Verify login functionality and the Xero connection flow by performing a hard refresh and retesting.
</optional_next_step>
